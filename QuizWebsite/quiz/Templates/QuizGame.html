{% extends "base.html" %}
{% load static %}

<html>
	{% block head %}
        <title>Question</title>
    {% endblock %}


	{% block body %}
  <body>
		<h1 align="center"> <b>Question</b> </h1>
        <p>
                <!--Show Problem-->
                <button id = "problem"
                        class = "questionPos">

                </button>

                <!--Show choice 1-->
		        <button onclick ="choice1()"
                        id = "choice1"
                        class = "choicePos1">
                </button>

                <!--Show choice 2-->
                <button onclick ="choice2()"
                        id = "choice2"
                        class = "choicePos2">
                </button>

                <!--Show choice 3-->
                <button onclick ="choice3()"
                        id = "choice3"
                        class = "choicePos3">
                </button>

                <!--Show answer-->
                <button onclick ="answer()"
                        id = "answer"
                        class = "choicePos4">
                </button>

                <!--Next button hidden until an choice is chosen, updates html for next question-->
                <button style="display:none"
                        onclick ="next()"
                        id = "next"
                        class = "NextDone">
                    Next
                </button>

                <!--Done button hidden until last question choice is chosen, jumps to Results page-->
                <form
                      method= "POST"
                      action="{% url 'quiz:Result' %}"
                      >{% csrf_token %}
				    <button type="submit"
                            id = "done"
                            style="display:none"
                            class = "NextDone"
                            name = "results"
                            value = '0'>
                        Done
                    </button>
			    </form>

					<footer>
					 <p id="progress"></p>
			 		</footer>

                    <footer>
					 <p id="right"></p>
			 		</footer>
        </p>
        <script>
            // change queryset to JSON
            var x = JSON.parse("{{ question_json| safe | escapejs}}");

						//Current Question
						max = 10;

            // counter for which question
            var count = 0;

            /// counter for answer that are right
            var right = 0;
            document.getElementById("right").innerHTML = "Answers Right: "+ right;
            document.getElementById("done").value = right;

            // boolean to keep track for first choice for each question
            var firstPick = true;

            // set first question
            document.getElementById("problem").innerHTML = x[count].fields.problem;
            document.getElementById("choice1").innerHTML = x[count].fields.choice1;
            document.getElementById("choice2").innerHTML = x[count].fields.choice2;
            document.getElementById("choice3").innerHTML = x[count].fields.choice3;
            document.getElementById("answer").innerHTML = x[count].fields.answer;

            var element = document.getElementById("progress");
            var current = count + 1;
            element.innerHTML = current + " / " + max;

            RandomPos();


            // reveal wrong and reveal next button, if last question done button appears
            function choice1() {
                if(firstPick == true) {
                    document.getElementById("wrongSound").play();
                    document.getElementById("choice1").innerHTML = "No";
                    document.getElementById("choice1").style.backgroundColor = "rgb(255,0,0)";
                    if (count >= 9)
                        document.getElementById("done").style.display = "block";
                    else
                        revealNext();

                    // turn firstPickOff off
                    firstPick = false;
                }
            }

            // reveal wrong and reveal next button, if last question done button appears
            function choice2() {
                if(firstPick == true) {
                    document.getElementById("wrongSound").play();
                    document.getElementById("choice2").innerHTML = "No";
                    document.getElementById("choice2").style.backgroundColor = "rgb(255,0,0)";
                    if (count >= 9)
                        document.getElementById("done").style.display = "block";
                    else
                        revealNext();

                    // turn firstPickOff off
                    firstPick = false;
                }
            }

            // reveal wrong and reveal next button, if last question done button appears
            function choice3() {
                if(firstPick == true) {
                    document.getElementById("wrongSound").play();
                    document.getElementById("choice3").innerHTML = "No";
                    document.getElementById("choice3").style.backgroundColor = "rgb(255,0,0)";
                    if (count >= 9)
                        document.getElementById("done").style.display = "block";
                    else
                        revealNext();

                    // turn firstPickOff off
                    firstPick = false;
                }
            }

            // reveal answer and reveal next button, if last question done button appears
            function answer() {
                if(firstPick == true){
                    document.getElementById("rightSound").play();
                    document.getElementById("answer").innerHTML = "Yes";
                    document.getElementById("answer").style.backgroundColor = "rgb(50,205,50)";
                    if(count >= 9)
                         document.getElementById("done").style.display = "block";
                    else
                        revealNext();

                    // increase right answers
                    right = right + 1;
                    document.getElementById("right").innerHTML = "Answers Right: "+ right;
                    document.getElementById("done").value = right;

                    // turn firstPickOff off
                    firstPick = false;
                }

            }

            // function to reveal next button, if last question done button appears
            function revealNext(){
                var x = document.getElementById("next");
                if (x.style.display === "none") {
                    x.style.display = "block";
                }
            }

            // go to next question, change html for next question, hide next button
            function next(){
                 count = count + 1;

                 document.getElementById("problem").innerHTML = x[count].fields.problem;
                 document.getElementById("choice1").innerHTML = x[count].fields.choice1;
                 document.getElementById("choice2").innerHTML = x[count].fields.choice2;
                 document.getElementById("choice3").innerHTML = x[count].fields.choice3;
                 document.getElementById("answer").innerHTML = x[count].fields.answer;
                 document.getElementById("next").style.display = "none";
								 var element = document.getElementById("progress");
								 var current = count + 1;
		 						 element.innerHTML = current + " / " + max;
                RandomPos();

                // turn first choice back on
                firstPick = true;
            }

            // random position for choices and answers
            function RandomPos(){
                var choices = ["choice1", "choice2", "choice3", "answer"];

                // function from https://www.w3schools.com/js/js_array_sort.asp
                choices.sort(function(a, b){return 0.5 - Math.random()});

                // assigning random positions
                choices.forEach(assignPos);
            }

            // assigning position of choice in the ForEach of RandomPos function
            function assignPos(value, index, array) {
                document.getElementById(value).style.backgroundColor = "rgb(211,211,211)";

                switch (index) {
                    case 0:
                        document.getElementById( value ).className = "choicePos1";
                        break;
                    case 1:
                        document.getElementById( value ).className = "choicePos2";
                        break;
                    case 2:
                        document.getElementById( value ).className = "choicePos3";
                        break;
                    case 3:
                        document.getElementById( value ).className = "choicePos4";
                        break;
                    default:
                        document.getElementById( ""+value ).className = "choicePos4";;
                }
            }


            function getRight(){
                return right;
            }
        </script>

        <audio id="wrongSound" src = "{% static "QuizWebsite/Wrong-answer-sound-effect.mp3" %}" preload="auto" >
        </audio>

        <audio id="rightSound" src = "{% static "QuizWebsite/Quiz-correct-win-victory-sound-effect.mp3" %}" preload="auto" ></audioid>
        </audio>

        <style>
            .questionPos{
                position: fixed;
                top: 35%;
                left: 40%;
                width: 20%;
                height: 10%;
                text-align: center;
                border: 3px solid #73AD21;
                background-color: rgb(211,211,211);
            }
            .choicePos1 {
                position: fixed;
                top: 50%;
                left: 22.5%;
                width: 20%;
                height: 10%;
                text-align: center;
                border: 3px solid #73AD21;
                background-color: rgb(211,211,211);
            }
            .choicePos2 {
                position: fixed;
                top: 50%;
                left: 57.5%;
                width: 20%;
                height: 10%;
                text-align: center;
                border: 3px solid #73AD21;
                background-color: rgb(211,211,211);
            }
            .choicePos3 {
                position: fixed;
                top: 65%;
                left: 22.5%;
                width: 20%;
                height: 10%;
                text-align: center;
                border: 3px solid #73AD21;
                background-color: rgb(211,211,211);
            }
            .choicePos4 {
                position: fixed;
                top: 65%;
                left: 57.5%;
                width: 20%;
                height: 10%;
                text-align: center;
                border: 3px solid #73AD21;
                background-color: rgb(211,211,211);
            }
            .NextDone{
                position: fixed;
                top: 85%;
                left: 75%;
                width: 20%;
                height: 10%;
                text-align: center;
                border: 3px solid #73AD21;
                background-color: rgb(211,211,211);
            }
        </style>

	</body>
    {% endblock %}


</html>
